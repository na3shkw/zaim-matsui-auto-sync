services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        UID: ${UID:-1000}
        GID: ${GID:-1000}
    environment:
      NODE_ENV: production
      CHROMIUM_USER_DATA_DIR_GOOGLE: /home/appuser/.config/appdata/chromium/google
      CHROMIUM_USER_DATA_DIR_MATSUI: /home/appuser/.config/appdata/chromium/matsui
      ZAIM_ACCESS_TOKEN_FILE: /home/appuser/.config/appdata/zaim/zaim-tokens.json
      ZAIM_TOTAL_AMOUNT_FILE: /home/appuser/.config/appdata/zaim/zaim-total-amount.json
      CONFIG_FILE: /home/appuser/.config/appdata/config.json
    env_file:
      - .env
    security_opt:
      - seccomp:./seccomp-profile.json
    user: appuser:appuser
    volumes:
      - type: volume
        source: chromium-data
        target: /home/appuser/.config/appdata/chromium
      - type: bind
        source: ./appdata/zaim
        target: /home/appuser/.config/appdata/zaim
        consistency: consistent
      - type: bind
        source: ./config.json
        target: /home/appuser/.config/appdata/config.json
        consistency: consistent
        read_only: true
    network_mode: "host"
    init: true
    ipc: "host"

volumes:
  chromium-data:
